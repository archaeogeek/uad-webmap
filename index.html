<!DOCTYPE html>
<html>
	<head>
		<title>QGIS2leaf webmap</title>
		<meta charset="utf-8" />
		<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css" />
		<link rel="stylesheet" type="text/css" href="css/own_style.css">
		<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
		<script src="http://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"></script>
		<script src="js/leaflet-hash.js"></script>
		<script src="js/Autolinker.min.js"></script>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<link rel="shortcut icon" href="./favicon.ico" type="image/x-icon" />
		<link rel="stylesheet" href="css/uad.css" type="text/css" media="all">
		<link rel="stylesheet" href="css/leaflet-search.css" />
		<script src="js/leaflet-search.min.js"></script>
		<script src="http://cdnjs.cloudflare.com/ajax/libs/fuse.js/1.2.2/fuse.min.js"></script>
		<link rel="stylesheet" href="css/leaflet-layer-tree-control.css"/>
		<script type="text/javascript" src="js/leaflet-layer-tree-control.js"></script>
		<script type="text/javascript">
		<!--
			jQuery(document).ready(function(){jQuery(window).scroll(function(){if(jQuery(this).scrollTop()>100){jQuery(".scroll-to-top").fadeIn()}else{jQuery(".scroll-to-top").fadeOut()}});jQuery(".scroll-to-top").click(function(){jQuery("html, body").animate({scrollTop:0},800);return false})})
			
			function menutoggle(){
				$('#menuitems').toggle(500);
				var menuon=document.getElementById("#menuitems").style.display;
				if(menuon=="none"){
					document.getElementById("menu").style.border = "none";
				}
			}
			
			function clearcookiedisplay(){
				$('#cookies').hide(500);
			}
		-->
		</script>
		<noscript>
		<style type="text/css">
		@media screen and (max-width: 770px) {
			#logo img{
				max-width: 100%;
			}
			#menuitems{
				display: block;
			}
			a#menubutton {
				display: none;
			}
		}
		</style>
		</noscript>
	</head>
	<body class="home blog">
		<div id="page" class="hfeed site">
		<header id="masthead" class="site-header" role="banner">
			<div class="row" id="menu">
				<div id="logo">
					<a href="http://beyondthecastle.org/"><img src="./images/btc_header2.gif" alt="Beyond The Castle" height="76" width="379"></a>
				</div><!-- end of #logo -->
				<div id="menuitems">
					<ul>
					<li><a title="Home" href="http://beyondthecastle.org/">Home</a></li>
					<li><a title="About the Project" href="http://beyondthecastle.org/about/">About the Project</a></li>
					<li><a title="Contact" href="http://beyondthecastle.org/contact/">Contact</a></li>
					</ul>
				</div>
				<a id="menubutton" onclick="menutoggle()" title="Toggle menu display."></a>
				
			</div>
		</header><!-- #masthead -->

		<div id="content" class="row">
			
			<div class="block">
				<div id="map"></div>
				<div class="sub-nav">
					<a href="./" class="button">Help using the map</a>
				</div><!-- sub-nav -->
			
			</div><!-- block -->

		</div><!-- close .main-content -->
				<script>
					var map = L.map('map', {
						zoomControl:true, maxZoom:19
					}).fitBounds([[54.0431212658,-2.82615556208],[54.0574685136,-2.78264763832]]);
					var hash = new L.Hash(map);
					var additional_attrib = 'created w. <a href="https://github.com/geolicious/qgis2leaf" target ="_blank">qgis2leaf</a> by <a href="http://www.geolicious.de" target ="_blank">Geolicious</a> & contributors<br>';
					var feature_group = new L.featureGroup([]);
					var raster_group = new L.LayerGroup([]);
					var basemap_0 = L.tileLayer('http://a.tile.stamen.com/toner/{z}/{x}/{y}.png', { 
						attribution: additional_attrib + 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data: &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors,<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'
					});	
					basemap_0.addTo(map);	
					var layerOrder=new Array();
					
					var overlay_Baines1824 = L.tileLayer.wms('http://lancasteruadgeo.oxfordarchaeology.com/geoserver/uad/wms?version=1.1.0', {
						layers: 'Baines1824',
						format: 'image/png',
						transparent: true,
						continuousWorld : true,
					}).addTo(map);

					var overlay_Clarke1807 = L.tileLayer.wms('http://lancasteruadgeo.oxfordarchaeology.com/geoserver/uad/wms?version=1.1.0', {
						layers: 'Clarke1807',
						format: 'image/png',
						transparent: true,
						continuousWorld : true,
					}).addTo(map);

					var overlay_Mackreth1778 = L.tileLayer.wms('http://lancasteruadgeo.oxfordarchaeology.com/geoserver/uad/wms?version=1.1.0', {
						layers: 'Mackreth1778',
						format: 'image/png',
						transparent: true,
						continuousWorld : true,
					}).addTo(map);

					var overlay_Docton1684 = L.tileLayer.wms('http://lancasteruadgeo.oxfordarchaeology.com/geoserver/uad/wms?version=1.1.0', {
						layers: 'Docton1684',
						format: 'image/png',
						transparent: true,
						continuousWorld : true,
					}).addTo(map);

					var overlay_OS_1_25 = L.tileLayer.wms('http://lancasteruadgeo.oxfordarchaeology.com/geoserver/uad/wms?version=1.1.0', {
						layers: 'OS First Edition 25 inch',
						format: 'image/png',
						transparent: true,
						continuousWorld : true,
					}).addTo(map);

					var uadlistedpolysURL='http://lancasteruadgeo.oxfordarchaeology.com/geoserver/wfs?SERVICE=WFS&VERSION=1.0.0&REQUEST=GetFeature&TYPENAME=uad:listed_polys&SRSNAME=EPSG:27700&outputFormat=text%2Fjavascript&format_options=callback%3AgetuadlistedpolysJson';
					uadlistedpolysURL=uadlistedpolysURL.replace(/SRSNAME\=EPSG\:\d+/, 'SRSNAME=EPSG:4326');
					var exp_uadlistedpolysJSON = L.geoJson(null, {
						style: function (feature) {
							return {
								color: '#000000',
								fillColor: '#d4a777',
								weight: 1.3,
								dashArray: '',
								opacity: 1.0,
								fillOpacity: 1.0
							};

						},
						onEachFeature: function (feature, layer){					
						var popupContent = '<table><tr><th scope="row">gid</th><td>' + Autolinker.link(String(feature.properties['gid'])) + '</td></tr><tr><th scope="row">id</th><td>' + Autolinker.link(String(feature.properties['id'])) + '</td></tr><tr><th scope="row">eventid</th><td>' + Autolinker.link(String(feature.properties['eventid'])) + '</td></tr><tr><th scope="row">monumentid</th><td>' + Autolinker.link(String(feature.properties['monumentid'])) + '</td></tr><tr><th scope="row">name</th><td>' + Autolinker.link(String(feature.properties['name'])) + '</td></tr><tr><th scope="row">field1</th><td>' + Autolinker.link(String(feature.properties['field1'])) + '</td></tr></table>';
						layer.bindPopup(popupContent);
						}
					});
					layerOrder[layerOrder.length] = exp_uadlistedpolysJSON;
					var uadlistedpolysajax = $.ajax({
						url : uadlistedpolysURL,
						dataType : 'jsonp',
						jsonpCallback : 'getuadlistedpolysJson',
						contentType : 'application/json',
						success : function (response) {
							L.geoJson(response, {
								onEachFeature: function (feature, layer) {
									exp_uadlistedpolysJSON.addData(feature)
								}
							});
							for (index = 0; index < layerOrder.length; index++) {
								feature_group.removeLayer(layerOrder[index]);feature_group.addLayer(layerOrder[index]);
							}
						}
					});
					//add comment sign to hide this layer on the map in the initial view.
					feature_group.addLayer(exp_uadlistedpolysJSON);

					var uadhumanreadableimagesURL='http://lancasteruadgeo.oxfordarchaeology.com/geoserver/wfs?SERVICE=WFS&VERSION=1.0.0&REQUEST=GetFeature&TYPENAME=uad:human_readable_images&SRSNAME=EPSG:27700&outputFormat=text%2Fjavascript&format_options=callback%3AgetuadhumanreadableimagesJson';
					uadhumanreadableimagesURL=uadhumanreadableimagesURL.replace(/SRSNAME\=EPSG\:\d+/, 'SRSNAME=EPSG:4326');
					var exp_uadhumanreadableimagesJSON = L.geoJson(null, {
						pointToLayer: function (feature, latlng) {  
							return L.circleMarker(latlng, {
								radius: 4.0,
								fillColor: '#758410',
								color: '#000000',
								weight: 1,
								opacity: 1.0,
								fillOpacity: 1.0
							})
						},
						onEachFeature: function (feature, layer) {					
						var popupContent = '<table><tr><th scope="row">UADImageReferenceNumber</th><td>' + Autolinker.link(String(feature.properties['UADImageReferenceNumber'])) + '</td></tr><tr><th scope="row">Easting</th><td>' + Autolinker.link(String(feature.properties['Easting'])) + '</td></tr><tr><th scope="row">Northing</th><td>' + Autolinker.link(String(feature.properties['Northing'])) + '</td></tr><tr><th scope="row">PositionAccuracy</th><td>' + Autolinker.link(String(feature.properties['PositionAccuracy'])) + '</td></tr><tr><th scope="row">Hyperlink</th><td>' + Autolinker.link(String(feature.properties['Hyperlink'])) + '</td></tr><tr><th scope="row">Description</th><td>' + Autolinker.link(String(feature.properties['Description'])) + '</td></tr></table>';
						layer.bindPopup(popupContent);
						}
					});
					layerOrder[layerOrder.length] = exp_uadhumanreadableimagesJSON;
					var uadhumanreadableimagesajax = $.ajax({
						url : uadhumanreadableimagesURL,
						dataType : 'jsonp',
						jsonpCallback : 'getuadhumanreadableimagesJson',
						contentType : 'application/json',
						success : function (response) {
							L.geoJson(response, {
								onEachFeature: function (feature, layer) {
									exp_uadhumanreadableimagesJSON.addData(feature)
								}
							});
							for (index = 0; index < layerOrder.length; index++) {
								feature_group.removeLayer(layerOrder[index]);feature_group.addLayer(layerOrder[index]);
							}
						}
					});
					//add comment sign to hide this layer on the map in the initial view.
					feature_group.addLayer(exp_uadhumanreadableimagesJSON);

					feature_group.addTo(map);
					var title = new L.Control();
					title.onAdd = function (map) {
						this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
						this.update();
						return this._div;
					};
					title.update = function () {
						this._div.innerHTML = '<h2>Lancaster Urban Archaeological Database</h2>Interactive Map'
					};
					title.addTo(map);
				var baseMaps = {
					'Stamen Toner': basemap_0
				};
					L.control.layers(baseMaps,{"uadhumanreadableimages": exp_uadhumanreadableimagesJSON,"uadlistedpolys": exp_uadlistedpolysJSON,"Baines' Map of 1824": overlay_Baines1824, "Clarke's Map of 1807": overlay_Clarke1807, "Mackreth's Map of 1778": overlay_Mackreth1778, "Docton's Map of 1684": overlay_Docton1684, "Ordnance Survey First Edition 25inch": overlay_OS_1_25},{collapsed:false}).addTo(map);
					L.control.scale({options: {position: 'bottomleft',maxWidth: 100,metric: true,imperial: false,updateWhenIdle: false}}).addTo(map);


				var controlSearch = new L.Control.Search({layer: exp_uadhumanreadableimagesJSON, initial: true, propertyName:'UADImageReferenceNumber'});

				map.addControl( controlSearch );
			</script>


<footer id="colophon" class="site-footer" role="contentinfo">
	<div class="row">
		<a id="facebook"></a>			
		
		<nav role="navigation">
			<div class="half">
				<ul id="menu-footer-menu" class="nav footer-nav clearfix">
				<li id="menu-item-145" class="menu-item menu-item-type-custom menu-item-object-custom current-menu-item current_page_item menu-item-home menu-item-145"><a href="http://beyondthecastle.org/">Home</a></li>
				<li id="menu-item-149" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-149"><a href="http://beyondthecastle.org/what-you-can-do-to-help/">What You Can Do To Help</a>
				<ul class="sub-menu">
					<li id="menu-item-150" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-150"><a href="http://beyondthecastle.org/get-involved-2/">Get Involved</a></li>
				</ul>
				</li>
				<li id="menu-item-142" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-142"><a href="http://beyondthecastle.org/contact/">Contact</a></li>
				</ul>
			</div>
			<div class="half">
				<div class="copyright"><a href="http://beyondthecastle.org/wordpress/" title="Beyond The Castle">Beyond The Castle</a>  All rights reserved.</div>
			</div>
			
		</nav>
	</div>
	<div style="display: none;" class="scroll-to-top">&#094;</div><!-- .scroll-to-top -->
	
</footer><!-- #colophon -->

<!-- #page -->

</body>
</html>